{# Spine router bgp base configuration whith EBGP #}
{% if type == "spine" %}
{%     if switch.overlay_routing_protocol == "ebgp"  %}
  as: {{ spine.bgp_as }}
  router_id: {{ overlay_loopback_network_summary | ipaddr('network') | ipmath(spine.nodes[inventory_hostname].id) }}
  bgp_defaults:
{%         for bgp_default in spine_bgp_defaults %}
    - {{ bgp_default }}
{%         endfor %}
    - maximum-paths {{ spine.nodes | length }} ecmp {{ spine.nodes | length }}
{# Spine router bgp base configuration when IBGP route-reflector in the overlay #}
{%     elif switch.overlay_routing_protocol == "ibgp" and switch.is_route_reflector == true %}
  as: {{ bgp_as }}
  router_id: {{ overlay_loopback_network_summary | ipaddr('network') | ipmath(spine.nodes[inventory_hostname].id) }}
  bgp_defaults:
{%         for bgp_default in spine_bgp_defaults %}
    - {{ bgp_default }}
{%         endfor %}
    - maximum-paths {{ spine.nodes | length }} ecmp {{ spine.nodes | length }}
  bgp_cluster_id: {{ overlay_loopback_network_summary  | ipaddr('network') | ipmath(spine.nodes[inventory_hostname].id) }}
{%     endif %}
{% endif %}
